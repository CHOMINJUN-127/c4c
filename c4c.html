<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>c4c</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
    }

    .Bigname{
      text-align: center;
      margin-top: 90px;
      font-size: 4rem;
      margin-bottom: 30px;
      color: #8A2BE2;
    }

/* 1. ë“œë¡­ë‹¤ìš´ì˜ ë¶€ëª¨ ì»¨í…Œì´ë„ˆ - ìœ„ì¹˜ ê¸°ì¤€ì  ì„¤ì • */
    .dropdown {
        position: relative; 
        display: inline-block;
        z-index: 10001; /* í˜ì´ì§€ ë‚´ ë‹¤ë¥¸ ì–´ë–¤ ìš”ì†Œë³´ë‹¤ ìœ„ì— ìˆë„ë¡ ì„¤ì • */
    }

    /* 2. ì¡°ì´ìŠ¤í‹± ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³´ì • */
    .circle {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        cursor: pointer;
        font-size: 50px;
        background-color: #ffffff; /* ë²„íŠ¼ ë°°ê²½ì„ í°ìƒ‰ìœ¼ë¡œ ëª…í™•íˆ */
        box-shadow: 0 4px 10px rgba(0,0,0,0.1); /* ë²„íŠ¼ ìì²´ì—ë„ ê·¸ë¦¼ì ë¶€ì—¬ */
        transition: all 0.3s;
        position: relative;
    }

    /* 3. ë“œë¡­ë‹¤ìš´ ì»¨í…ì¸  - ë°°ê²½ ë° ë ˆì´ì–´ í•µì‹¬ ìˆ˜ì • */
    .dropdown-content {
        visibility: hidden;
        opacity: 0;
        position: absolute;
        top: 100%; 
        left: 50%;
        transform: translateX(-50%) translateY(10px);
        
        /* ë°°ê²½ ì¶©ëŒ í•´ê²°: í°ìƒ‰ ë°°ê²½ì— ì•„ì£¼ ì§„í•œ ê·¸ë¦¼ìë¥¼ ë„£ì–´ ì°¨íŠ¸ ìœ„ì—ì„œë„ ë‹ë³´ì´ê²Œ í•¨ */
        background-color: #ffffff !important; 
        min-width: 200px;
        box-shadow: 0px 15px 35px rgba(0,0,0,0.25); /* ê·¸ë¦¼ì ê°•í™” */
        
        z-index: 10002; /* ì°¨íŠ¸(ë³´í†µ z-indexê°€ ë‚®ìŒ)ë³´ë‹¤ í›¨ì”¬ ë†’ê²Œ ì„¤ì • */
        border-radius: 12px;
        border: 1px solid rgba(0, 0, 0, 0.08); /* ì˜…ì€ í…Œë‘ë¦¬ë¡œ ê²½ê³„ êµ¬ë¶„ */
        overflow: hidden;
        margin-top: 15px;
        
        /* ì‚¬ë¼ì§€ëŠ” ì†ë„ 1.5ì´ˆ ìœ ì§€ */
        transition: opacity 1.5s ease, visibility 1.5s ease, transform 1.5s ease;
    }

    /* 4. ë§ˆìš°ìŠ¤ ì´ë™ í†µë¡œ (ì§•ê²€ë‹¤ë¦¬) */
    .dropdown::after {
        content: "";
        position: absolute;
        width: 140%; 
        height: 30px; 
        bottom: -30px;
        left: -20%;
        background: transparent;
        z-index: -1; /* ë²„íŠ¼ ë’¤ë¡œ ìˆ¨ê¹€ */
    }

    /* 5. í˜¸ë²„ ì•¡ì…˜ */
    .dropdown:hover .dropdown-content {
        visibility: visible;
        opacity: 1;
        transform: translateX(-50%) translateY(0);
        transition: opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease;
    }

    /* 6. ë©”ë‰´ ë§í¬ ìŠ¤íƒ€ì¼ */
    .dropdown-content a {
        color: #333;
        padding: 15px 20px;
        text-decoration: none;
        display: block;
        font-size: 16px;
        text-align: left;
        font-weight: bold;
        background-color: #ffffff; /* ë§í¬ ìì²´ ë°°ê²½ë„ í°ìƒ‰ ê³ ì • */
        border-bottom: 1px solid #f0f0f0;
    }

    .dropdown-content a:hover {
        background-color: #f4ebff !important;
        color: #8A2BE2;
    }

    .circle{
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      font-size: 50px;
      background-color: #f0f0f0;
      transition: all 0.3s;
    }

    .circle:hover {
      background-color: #e0e0e0;
      transform: scale(1.1);
    }

    .circle-container {
      display: flex;
      justify-content: center;
      margin-bottom: 50px;
    }

    .Excel, .PDF {
        width: 200px;
        height: 60px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
    }

    .Excel {
        background-color: #4CAF50;
        color: white;
    }

    .Excel:hover {
        background-color: #45a049;
        transform: scale(1.05);
    }

    .PDF {
        background-color: #f44336;
        color: white;
    }

    .PDF:hover {
        background-color: #da190b;
        transform: scale(1.05);
    }

    .button-container {
        display: flex;
        gap: 50px;
        margin-top: 50px;
        margin-bottom: 30px;
        justify-content: center;
    }

    input[type="file"] {
      display: none;
    }

    .controls {
      margin: 20px 0;
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
      display: none;
    }

    .controls.active {
      display: flex;
    }

    .control-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    label {
      font-weight: 600;
      font-size: 16px;
    }

    select {
      padding: 10px 15px;
      border: 2px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
    }

    .chart-container {
      margin-top: 20px;
      padding: 30px;
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
      background-color: white;
      border-radius: 8px;
      display: none;
    }

    .chart-container.active {
      display: block;
    }

    .chart-wrapper {
      position: relative;
      height: 450px;
      margin-bottom: 20px;
    }

    .message {
      text-align: center;
      margin: 20px auto;
      padding: 15px;
      border-radius: 4px;
      max-width: 500px;
      display: none;
    }

    .message.error {
      background-color: #fee;
      color: #c33;
      display: block;
    }

    .message.success {
      background-color: #efe;
      color: #3c3;
      display: block;
    }

    .pdf-summary {
      max-width: 900px;
      margin: 30px auto;
      padding: 30px;
      background-color: white;
      border-radius: 8px;
      display: none;
    }

    .pdf-summary.active {
      display: block;
    }

    .pdf-summary h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.5rem;
      border-bottom: 2px solid #ddd;
      padding-bottom: 10px;
    }

    .summary-text {
      line-height: 2;
      font-size: 16px;
      color: #444;
    }

    .summary-text p {
      margin-bottom: 20px;
      padding: 15px;
      background-color: #f9f9f9;
      border-left: 4px solid #8A2BE2;
      border-radius: 4px;
      text-align: justify;
    }
</style>

<body>
    <div>
        <h1 class="Bigname">c4c</h1>
    </div>

    <!-- <div class="circle-container">
        <button class="circle" ondblclick="location.href='index.html'">ğŸ•¹ï¸</button>
    </div> -->

    <div class="circle-container">
        <div class="dropdown">
            <button class="circle">ğŸ•¹ï¸</button>
            <div class="dropdown-content">
                <a href="index.html">ğŸ  ë©”ì¸ìœ¼ë¡œ í˜ì´ì§€</a>
                <a href="c4c+.html">âœ¨ ì§„ë‹¨ì‹œìŠ¤í…œ</a>
            </div>
        </div>
    </div>


    <div class="button-container">
        <button class="Excel" onclick="document.getElementById('excelInput').click()">ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</button>
        <button class="PDF" onclick="document.getElementById('pdfInput').click()">PDF íŒŒì¼ ì—…ë¡œë“œ</button>
    </div>

    <input type="file" id="excelInput" accept=".csv">
    <input type="file" id="pdfInput" accept=".pdf">

    <div id="message" class="message"></div>

    <div class="controls" id="controls">
        <div class="control-group">
            <label for="xAxis">Xì¶•:</label>
            <select id="xAxis" onchange="createChart()"></select>
        </div>
        <div class="control-group">
            <label for="yAxis">Yì¶•:</label>
            <select id="yAxis" onchange="createChart()"></select>
        </div>
        <div class="control-group">
            <label for="chartType">ê·¸ë˜í”„ ìœ í˜•:</label>
            <select id="chartType" onchange="createChart()">
                <option value="line">ì„  ê·¸ë˜í”„</option>
                <option value="bar">ë§‰ëŒ€ ê·¸ë˜í”„</option>
                <option value="scatter">ì‚°ì ë„</option>
            </select>
        </div>
    </div>

    <div class="chart-container" id="chartContainer">
        <div class="chart-wrapper">
            <canvas id="myChart"></canvas>
        </div>
    </div>

    <div class="pdf-summary" id="pdfSummary">
        <h2>PDF ìš”ì•½</h2>
        <div class="summary-text" id="summaryText"></div>
    </div>

    <script>
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
        }

        let currentData = [];
        let columns = [];
        let chart = null;

        // CSV íŒŒì¼ ì—…ë¡œë“œ
        document.getElementById('excelInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            console.log('CSV íŒŒì¼ ì„ íƒë¨:', file.name);
            document.getElementById('pdfSummary').classList.remove('active');
            showMessage('íŒŒì¼ì„ ì½ëŠ” ì¤‘...', 'success');

            const reader = new FileReader();

            reader.onload = function(event) {
                console.log('CSV íŒŒì¼ ì½ê¸° ì™„ë£Œ');
                try {
                    let text = event.target.result;
                    
                    // ì—¬ëŸ¬ ì¢…ë¥˜ì˜ BOM ì œê±°
                    text = text.replace(/^\uFEFF/, '');
                    text = text.replace(/^\ufeff/, '');
                    text = text.replace(/^\u00EF\u00BB\u00BF/, '');
                    
                    // íŠ¹ìˆ˜ ë¬¸ì ì œê±°
                    text = text.replace(/\ufffd/g, '');
                    text = text.replace(/ï¿½/g, '');
                    
                    // ì¤„ ë¶„ë¦¬
                    const lines = text.split(/\r\n|\n|\r/).filter(line => line.trim().length > 0);
                    console.log('ì´ ë¼ì¸ ìˆ˜:', lines.length);
                    
                    if (lines.length < 1) {
                        showMessage('íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
                        return;
                    }

                    // í—¤ë” íŒŒì‹± - íŠ¹ìˆ˜ë¬¸ì ì œê±°
                    const headerLine = lines[0].replace(/ï¿½/g, '').replace(/\ufffd/g, '');
                    columns = headerLine.split(',').map(h => h.trim().replace(/[^\w\sã„±-ã…ã…-ã…£ê°€-í£]/g, ''));
                    console.log('ì»¬ëŸ¼:', columns);

                    // ë°ì´í„° íŒŒì‹±
                    const data = [];
                    for (let i = 1; i < lines.length; i++) {
                        let line = lines[i].trim();
                        if (!line) continue;
                        
                        // íŠ¹ìˆ˜ë¬¸ì ì œê±°
                        line = line.replace(/ï¿½/g, '').replace(/\ufffd/g, '');

                        const values = line.split(',').map(v => v.trim());
                        
                        const row = {};
                        for (let j = 0; j < columns.length; j++) {
                            const val = values[j] || '';
                            const num = parseFloat(val);
                            row[columns[j]] = isNaN(num) ? val : num;
                        }
                        data.push(row);
                    }

                    console.log('íŒŒì‹±ëœ ë°ì´í„°:', data);

                    if (data.length === 0) {
                        showMessage('ë°ì´í„° í–‰ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
                        return;
                    }

                    currentData = data;
                    populateSelects();
                    document.getElementById('controls').classList.add('active');
                    document.getElementById('chartContainer').classList.add('active');
                    createChart();
                    showMessage('CSV íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');

                } catch (error) {
                    console.error('CSV íŒŒì‹± ì—ëŸ¬:', error);
                    showMessage('CSV íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: ' + error.message, 'error');
                }
            };

            reader.onerror = function(error) {
                console.error('FileReader ì—ëŸ¬:', error);
                showMessage('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
            };

            // EUC-KR ì‹œë„ í›„ UTF-8 ì‹œë„
            try {
                reader.readAsText(file, 'EUC-KR');
            } catch (e) {
                reader.readAsText(file, 'UTF-8');
            }
            e.target.value = '';
        });

        // PDF íŒŒì¼ ì—…ë¡œë“œ
        document.getElementById('pdfInput').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            console.log('PDF íŒŒì¼ ì„ íƒë¨:', file.name);
            document.getElementById('controls').classList.remove('active');
            document.getElementById('chartContainer').classList.remove('active');
            
            showMessage('PDFë¥¼ ì½ëŠ” ì¤‘...', 'success');

            try {
                const arrayBuffer = await file.arrayBuffer();
                console.log('ArrayBuffer í¬ê¸°:', arrayBuffer.byteLength);
                
                const loadingTask = pdfjsLib.getDocument({
                    data: arrayBuffer
                });
                
                const pdf = await loadingTask.promise;
                console.log('PDF ë¡œë“œ ì™„ë£Œ, ì´ í˜ì´ì§€:', pdf.numPages);
                
                let fullText = '';
                const maxPages = Math.min(pdf.numPages, 10);
                
                for (let i = 1; i <= maxPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n\n';
                    console.log(`í˜ì´ì§€ ${i} ì²˜ë¦¬ ì™„ë£Œ`);
                }

                console.log('ì¶”ì¶œëœ í…ìŠ¤íŠ¸ ê¸¸ì´:', fullText.length);

                // íŠ¹ìˆ˜ë¬¸ì ì œê±°
                fullText = fullText.replace(/ï¿½/g, '').replace(/\ufffd/g, '');

                if (fullText.trim().length === 0) {
                    document.getElementById('summaryText').innerHTML = '<p style="text-align: center; color: #999;">PDFì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì´ë¯¸ì§€ ê¸°ë°˜ PDFì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤)</p>';
                } else {
                    // í…ìŠ¤íŠ¸ ì •ë¦¬
                    const cleanText = fullText
                        .replace(/\s+/g, ' ')
                        .trim();
                    
                    // ë¬¸ì¥ ë‹¨ìœ„ë¡œ ë¶„ë¦¬
                    const sentences = cleanText.match(/[^.!?]+[.!?]+/g) || [cleanText];
                    
                    // ì ì ˆí•œ ê¸¸ì´ì˜ ë¬¸ë‹¨ ë§Œë“¤ê¸°
                    const paragraphs = [];
                    let currentParagraph = '';
                    
                    for (let sentence of sentences) {
                        sentence = sentence.trim();
                        if (sentence.length < 10) continue;
                        
                        currentParagraph += sentence + ' ';
                        
                        if (currentParagraph.length > 200) {
                            paragraphs.push(currentParagraph.trim());
                            currentParagraph = '';
                        }
                        
                        if (paragraphs.length >= 8) break;
                    }
                    
                    if (currentParagraph.trim() && paragraphs.length < 8) {
                        paragraphs.push(currentParagraph.trim());
                    }
                    
                    document.getElementById('summaryText').innerHTML = paragraphs
                        .map((p, index) => `
                            <p style="margin-bottom: 20px; padding: 15px; background-color: #f9f9f9; border-left: 4px solid #8A2BE2; border-radius: 4px; line-height: 1.8;">
                                ${p}
                            </p>
                        `)
                        .join('');
                }
                
                document.getElementById('pdfSummary').classList.add('active');
                showMessage('PDF íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                
            } catch (error) {
                console.error('PDF ì—ëŸ¬:', error);
                showMessage('PDF íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: ' + error.message, 'error');
            }

            e.target.value = '';
        });

        function populateSelects() {
            const xAxis = document.getElementById('xAxis');
            const yAxis = document.getElementById('yAxis');

            xAxis.innerHTML = '';
            yAxis.innerHTML = '';

            columns.forEach(col => {
                const opt1 = document.createElement('option');
                opt1.value = col;
                opt1.textContent = col;
                xAxis.appendChild(opt1);

                const opt2 = document.createElement('option');
                opt2.value = col;
                opt2.textContent = col;
                yAxis.appendChild(opt2);
            });

            if (columns.length > 1) {
                yAxis.value = columns[1];
            }
        }

        function createChart() {
            if (currentData.length === 0) return;

            const xCol = document.getElementById('xAxis').value;
            const yCol = document.getElementById('yAxis').value;
            const chartType = document.getElementById('chartType').value;

            const xData = currentData.map(row => row[xCol]);
            const yData = currentData.map(row => {
                const val = row[yCol];
                return isNaN(val) ? 0 : parseFloat(val);
            });

            const ctx = document.getElementById('myChart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            const chartConfig = {
                type: chartType,
                data: {
                    labels: xData,
                    datasets: [{
                        label: yCol,
                        data: yData,
                        borderColor: '#4CAF50',
                        backgroundColor: chartType === 'line' ? 'rgba(76, 175, 80, 0.1)' : '#4CAF50',
                        fill: true,
                        borderWidth: 2,
                        tension: 0.3,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointBackgroundColor: '#4CAF50',
                        pointBorderColor: '#4CAF50'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 0,
                                minRotation: 0
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };

            chart = new Chart(ctx, chartConfig);
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message ' + type;
            setTimeout(() => {
                if (msg.className.includes(type)) {
                    msg.className = 'message';
                }
            }, 3000);
        }
    </script>
</body>
</html>



