<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>c4c - ì§ˆë³‘ ë³€ì´ ë¶„ì„ ë° ìœ ì „ì²´ ì§„ë‹¨ ì‹œìŠ¤í…œ ğŸ•¹ï¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Archivo+Black&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Pretendard', 'Malgun Gothic', sans-serif; background-color: #f3f4f6; margin: 0; padding: 20px; }
        .container { max-width: 1500px; margin: auto; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); }
        
        /* í—¤ë” ì¤‘ì•™ ì •ë ¬ ë° ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .header-container { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            margin-bottom: 40px; 
            position: relative;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 20px;
        }
        
        .title-group { display: flex; align-items: center; gap: 15px; }

        .Bigname { 
            color: #7c3aed; 
            font-size: 48px; 
            font-weight: 900; 
            margin: 0; 
            letter-spacing: -2px;
            font-family: 'Archivo Black', sans-serif; 
            text-transform: lowercase; 
            text-shadow: 2px 2px 0px rgba(0,0,0,0.05); 
        }
        
        .sub-title { font-size: 24px; color: #111827; font-weight: 700; margin-top: 10px; }

        /* --- ì¡°ì´ìŠ¤í‹± ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìˆ˜ì • ë¶€ë¶„ --- */
        .dropdown { 
            position: relative; 
            display: inline-block; 
            margin-left: 10px; 
            margin-top: 5px; 
        }
        
        .circle { 
            width: 45px; height: 45px; border-radius: 50%; border: none; 
            background: #111827; color: white; cursor: pointer; font-size: 20px;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s;
        }
        
        .circle:hover { transform: scale(1.1); }

        .dropdown-content {
            /* display: none ëŒ€ì‹  visibilityì™€ opacityë¥¼ ì‚¬ìš©í•˜ì—¬ ì• ë‹ˆë©”ì´ì…˜ êµ¬í˜„ */
            visibility: hidden;
            opacity: 0;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ffffff;
            min-width: 160px;
            box-shadow: 0px 8px 16px rgba(0,0,0,0.1);
            border-radius: 12px;
            z-index: 100;
            overflow: hidden;
            border: 1px solid #e5e7eb;
            margin-top: 10px; /* ë²„íŠ¼ê³¼ì˜ ê°„ê²© */
            transition: all 0.4s ease; /* 0.4ì´ˆ ë™ì•ˆ ë¶€ë“œëŸ½ê²Œ ë‚˜íƒ€ë‚¨ */
        }

        /* ë§ˆìš°ìŠ¤ê°€ ë²„íŠ¼ê³¼ ë©”ë‰´ ì‚¬ì´ì˜ ë¹ˆ ê³µê°„ì„ ì§€ë‚˜ê°ˆ ë•Œ ë©”ë‰´ê°€ ì‚¬ë¼ì§€ì§€ ì•Šê²Œ í•˜ëŠ” 'ê°€êµ' */
        .dropdown::after {
            content: "";
            position: absolute;
            width: 100%;
            height: 20px; /* ê°„ê²©ì„ ë©”ì›Œì£¼ëŠ” ë†’ì´ */
            bottom: -20px;
            left: 0;
            display: none;
        }

        /* í˜¸ë²„ ì‹œ ê°€êµì™€ ë©”ë‰´ë¥¼ ë™ì‹œì— í™œì„±í™” */
        .dropdown:hover .dropdown-content {
            visibility: visible;
            opacity: 1;
        }
        .dropdown:hover::after {
            display: block;
        }

        .dropdown-content a {
            color: #374151;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            font-size: 14px;
            font-weight: 600;
            text-align: left;
        }
        .dropdown-content a:hover { background-color: #f3f4f6; color: #7c3aed; }
        /* --- ë“œë¡­ë‹¤ìš´ ìˆ˜ì • ë --- */

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px; }
        .stat-card { padding: 30px; border-radius: 16px; text-align: center; color: white; border: none; } 
        .card-1 { background-color: #059669; }
        .card-2 { background-color: #2563eb; }
        .card-3 { background-color: #7c3aed; }
        .stat-card p { margin: 12px 0 0; font-size: 2.5rem; font-weight: 800; }
        .upload-section { text-align: center; margin-bottom: 40px; padding: 50px; border: 2px dashed #d1d5db; border-radius: 20px; background: #fafafa; }
        .chart-container { margin-top: 40px; padding: 30px; border: 1px solid #e5e7eb; border-radius: 20px; background: white; overflow-x: auto; }
        .chart-title { font-size: 1.4rem; font-weight: 700; margin-bottom: 25px; color: #1f2937; border-left: 8px solid #2563eb; padding-left: 15px; }
        #data-table-wrapper { width: 100%; overflow-x: auto; max-height: 500px; border: 1px solid #e5e7eb; border-radius: 12px; }
        #data-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        #data-table th { background-color: #f9fafb; position: sticky; top: 0; padding: 15px; color: #4b5563; font-weight: 600; border-bottom: 2px solid #e5e7eb; }
        #data-table td { border: 1px solid #f3f4f6; padding: 12px; text-align: center; }
        .variant { background-color: #eef2ff !important; color: #4338ca !important; font-weight: bold; }
        .hidden { display: none; }
        button.upload-btn { padding: 16px 32px; cursor: pointer; background: #111827; color: white; border: none; border-radius: 12px; font-weight: 700; }
        .plot-area { min-width: 1200px; height: 500px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-container">
        <div class="title-group">
            <span class="Bigname">c4c</span>
            <span class="sub-title">- ì§ˆë³‘ ë³€ì´ ë¶„ì„ ë° ìœ ì „ì²´ ì§„ë‹¨ ì‹œìŠ¤í…œ</span>
            
            <div class="dropdown">
                <button class="circle">ğŸ•¹ï¸</button>
                <div class="dropdown-content">
                    <a href="index.html">ğŸ  ë©”ì¸ í˜ì´ì§€</a>
                    <a href="c4c.html">âœ¨ ì§„ë‹¨ì‹œìŠ¤í…œ</a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="upload-section">
        <p style="color: #6b7280; font-size: 18px; margin-bottom: 25px;">ë°ì´í„° ë¶„ì„ì„ ì‹œì‘í•˜ë ¤ë©´ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>
        <input type="file" id="file-input" accept=".csv" style="display: none;">
        <button class="upload-btn" onclick="document.getElementById('file-input').click()">ë°ì´í„° íŒŒì¼ ì„ íƒ</button>
    </div>

    <div id="dashboard" class="hidden">
        <div class="stats-grid">
            <div class="stat-card card-1"><h3>ì´ ë¶„ì„ ìƒ˜í”Œ</h3><p id="stat-samples">-</p></div>
            <div class="stat-card card-2"><h3>ë³€ì´ ìœ ì „ì ìˆ˜</h3><p id="stat-genes">-</p></div>
            <div class="stat-card card-3"><h3>ê²€ì¶œëœ ì´ ë³€ì´</h3><p id="stat-total-variants">-</p></div>
        </div>
        <div class="chart-container">
            <div class="chart-title">ğŸ“Š ìœ ì „ìë³„ ë³€ì´ ë°œìƒ ë¹ˆë„ (Top 30)</div>
            <div id="bar-chart" class="plot-area"></div>
        </div>
        <div class="chart-container">
            <div class="chart-title">ğŸ¯ ìœ ì „ìë³„ ë³€ì´ ì§‘ì¤‘ë„ ë¶„ì„ (Bubble Chart - Top 10)</div>
            <div id="bubble-chart" class="plot-area" style="height: 600px;"></div>
        </div>
        <div class="chart-container">
            <div class="chart-title">ğŸ“‹ ë³€ì´ ë°ì´í„° ë¦¬í¬íŠ¸ (WT ì œì™¸)</div>
            <div id="data-table-wrapper">
                <table id="data-table">
                    <thead><tr id="table-header"></tr></thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // ê¸°ì¡´ê³¼ ë™ì¼í•œ ìŠ¤í¬ë¦½íŠ¸ ë¡œì§ ìœ ì§€
    const fileInput = document.getElementById('file-input');
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) { processData(results.data); }
            });
        }
    });

    function processData(data) {
        if (data.length === 0) return;
        const headers = Object.keys(data[0]);
        const geneHeaders = headers.filter(h => h !== 'ID');
        let mutationCounts = {};
        let totalVariants = 0;
        geneHeaders.forEach(gene => mutationCounts[gene] = 0);
        data.forEach(row => {
            geneHeaders.forEach(gene => {
                if (row[gene] && String(row[gene]).toUpperCase() !== 'WT') {
                    mutationCounts[gene]++;
                    totalVariants++;
                }
            });
        });
        const sortedGenes = geneHeaders.filter(g => mutationCounts[g] > 0).sort((a, b) => mutationCounts[b] - mutationCounts[a]);
        document.getElementById('dashboard').classList.remove('hidden');
        document.getElementById('stat-samples').innerText = data.length.toLocaleString();
        document.getElementById('stat-genes').innerText = sortedGenes.length.toLocaleString();
        document.getElementById('stat-total-variants').innerText = totalVariants.toLocaleString();
        renderBarChart(sortedGenes.slice(0, 30), mutationCounts);
        renderBubbleChart(sortedGenes.slice(0, 10), mutationCounts);
        renderTable(data, ['ID', ...sortedGenes.slice(0, 15)]);
    }

    function renderBarChart(genes, counts) {
        const trace = { x: genes, y: genes.map(g => counts[g]), type: 'bar', marker: { color: '#2563eb' } };
        const layout = { xaxis: { tickangle: 0, tickfont: { size: 11 }, automargin: true, fixedrange: true }, yaxis: { title: 'ë³€ì´ ë¹ˆë„' }, margin: { t: 20, b: 50, l: 60, r: 20 }, autosize: true };
        Plotly.newPlot('bar-chart', [trace], layout);
    }

    function renderBubbleChart(genes, counts) {
        const values = genes.map(g => counts[g]);
        const trace = { x: genes, y: values, mode: 'markers', marker: { size: values.map(v => Math.sqrt(v) * 12), color: values, colorscale: 'Viridis', showscale: true }, text: genes.map((g, i) => `${g}: ${values[i]}ê±´`) };
        const layout = { xaxis: { tickangle: 0, tickfont: { size: 13, weight: 'bold' }, automargin: true }, yaxis: { title: 'ë³€ì´ ë¹ˆë„ (ê±´)' }, margin: { t: 20, b: 50, l: 60, r: 20 }, hovermode: 'closest' };
        Plotly.newPlot('bubble-chart', [trace], layout);
    }

    function renderTable(rawData, columns) {
        const headerRow = document.getElementById('table-header');
        const body = document.getElementById('table-body');
        headerRow.innerHTML = ''; body.innerHTML = '';
        columns.forEach(col => { const th = document.createElement('th'); th.innerText = col; headerRow.appendChild(th); });
        rawData.slice(0, 50).forEach(row => {
            const tr = document.createElement('tr');
            columns.forEach(col => {
                const td = document.createElement('td');
                const val = row[col];
                if (col !== 'ID' && val && String(val).toUpperCase() !== 'WT') { td.innerText = val; td.className = 'variant'; }
                else { td.innerText = (String(val).toUpperCase() === 'WT') ? '' : (val || ''); }
                tr.appendChild(td);
            });
            body.appendChild(tr);
        });
    }
</script>
</body>

</html>
